"use strict";function MainCtrl(a,b,c){var d=this;d.foodPlaces=a.foodPlaces,d.drinkPlaces=a.drinkPlaces,d.year=2006,d.circles=[],d.visual="Circles",d.getData=function(){return b.all([a.getFoodPlaces(),a.getDrinkPlaces()]).then(function(){d.createCircles(),d.addPoints()})},d.updateSlider=function(){c("Circles"===d.visual?$("#sliderLabel").val()>d.year?d.removePoints:d.addPoints:d.setHeatmap),$("#sliderLabel").val(d.year)},d.toggleVisual=function(){"Circles"===d.visual?(d.visual="Heatmap",d.setHeatmap()):(d.visual="Circles",d.heatmap.setMap(null),d.showCircles())},d.addPoints=function(){for(var a=0;a<d.circles.length;a++)d.circles[a].year===Number(d.year)&&(d.circles[a].setMap(d.map),google.maps.event.addListener(d.circles[a],"click",d.showInfoWindow))},d.removePoints=function(){for(var a=0;a<d.circles.length;a++)d.circles[a].year===Number(d.year)+1&&(d.circles[a].setMap(null),google.maps.event.clearListeners(d.circles[a],"click"))},d.formatPhone=function(a){return a=a.slice(2),a.substring(0,3)+"-"+a.substring(3,6)+"-"+a.substring(6,a.length)},d.makeMap=function(){var a={center:{lat:42.3601,lng:-71.0589},zoom:15};d.map=new google.maps.Map(document.getElementById("map-canvas"),a),$.getJSON("data/citylimit.topojson",function(a){var b=topojson.feature(a,a.objects.collection);d.map.data.addGeoJson(b)}),d.map.data.setStyle({fillColor:"red",fillOpacity:.06,strokeColor:"red",strokeWeight:1})},d.chooseColor=function(a){for(var b=0;b<d.drinkPlaces.length-1;b++)if(d.drinkPlaces[b][0]===Number(d.foodPlaces[a].location.latitude)&&d.drinkPlaces[b][1]===Number(d.foodPlaces[a].location.longitude))return"#0000FF";return"#FF0000"},d.createCircles=function(){for(var a=0;a<d.foodPlaces.length;a++){var b=d.chooseColor(a),c=Number(d.foodPlaces[a].licenseadddttm.substring(0,4)),e={lat:Number(d.foodPlaces[a].location.latitude),lng:Number(d.foodPlaces[a].location.longitude)},f=new google.maps.Circle({strokeColor:b,strokeOpacity:.8,strokeWeight:2,fillColor:b,fillOpacity:.6,clickable:!0,name:d.foodPlaces[a].businessname,address:d.foodPlaces[a].address,city:d.foodPlaces[a].city,phone:d.formatPhone(d.foodPlaces[a].dayphn),year:c,center:e,radius:10});d.circles.push(f)}},d.showInfoWindow=function(a){d.infoWindow&&d.infoWindow.close(),d.infoWindow=new google.maps.InfoWindow({content:'<div class="info"><h2>'+this.name+"</h2><h3>"+this.address+", "+this.city+"</h3><h4>Phone: "+this.phone+"</h4></div>"}),d.infoWindow.setPosition(a.latLng),d.infoWindow.open(d.map)},d.setHeatmap=function(){for(var a=[],b=0;b<d.circles.length;b++)d.circles[b].setMap(null),google.maps.event.clearListeners(d.circles[b],"click");d.heatmap&&d.heatmap.setMap(null);for(var b=0;b<d.foodPlaces.length;b++){var c=Number(d.foodPlaces[b].licenseadddttm.substring(0,4));c<=Number(d.year)&&a.push(new google.maps.LatLng(Number(d.foodPlaces[b].location.latitude),Number(d.foodPlaces[b].location.longitude)))}var e=new google.maps.MVCArray(a);d.heatmap=new google.maps.visualization.HeatmapLayer({data:e}),d.heatmap.setMap(d.map),d.heatmap.set("radius",50),d.heatmap.set("maxIntensity",10)},d.showCircles=function(){for(var a=0;a<d.circles.length;a++)d.circles[a].year<=Number(d.year)&&(d.circles[a].setMap(d.map),google.maps.event.addListener(d.circles[a],"click",d.showInfoWindow))},d.makeMap(),d.getData()}angular.module("foodApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]),angular.module("foodApp").controller("MainCtrl",MainCtrl),MainCtrl.$inject=["requestFactory","$q","$timeout"],angular.module("foodApp").factory("requestFactory",["$http",function(a){var b=[],c=[],d=function(){return a.get("https://data.cityofboston.gov/resource/gb6y-34cq.json?$limit=3000&$$app_token=o8G9RFyZIGBbm4xexFrdV0Rfk").then(function(a){angular.copy(a.data,b)})},e=function(){return a.get("https://data.cityofboston.gov/resource/hda6-fnsh.json?$limit=3000&$$app_token=o8G9RFyZIGBbm4xexFrdV0Rfk").then(function(a){for(var b=0;b<a.data.length;b++)"NULL"!==a.data[b].location&&c.push([f(a.data[b].location),g(a.data[b].location)])})},f=function(a){var b=/\(.*,/;return a=b.exec(a)[0],a=a.slice(1),a=a.slice(0,-1),Number(a)},g=function(a){var b=/\s.*\)/;return a=b.exec(a)[0],a=a.slice(1),a=a.slice(0,-1),Number(a)};return{foodPlaces:b,drinkPlaces:c,getFoodPlaces:d,getDrinkPlaces:e}}]);