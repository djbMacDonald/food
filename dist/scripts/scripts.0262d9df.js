"use strict";function MainCtrl(a,b,c){var d,e=this;e.foodPlaces=a.foodPlaces,e.drinkPlaces=a.drinkPlaces,e.year=2006,e.circles=[],e.visual="Circles",e.getData=function(){b.all([a.getFoodPlaces(),a.getDrinkPlaces()]).then(function(){e.createCircles(),e.addPoints()})},e.updateSlider=function(){c("Circles"===e.visual?$("#sliderLabel").val()>e.year?e.removePoints:e.addPoints:e.setHeatmap),$("#sliderLabel").val(e.year)},e.toggleVisual=function(){"Circles"===e.visual?(e.visual="Heatmap",e.setHeatmap()):(e.visual="Circles",e.heatmap.setMap(null),e.showCircles())},e.addPoints=function(){for(var a=0;a<e.circles.length;a++)e.circles[a].year===Number(e.year)&&(e.circles[a].setMap(e.map),google.maps.event.addListener(e.circles[a],"click",e.showInfoWindow))},e.removePoints=function(){for(var a=0;a<e.circles.length;a++)e.circles[a].year===Number(e.year)+1&&(e.circles[a].setMap(null),google.maps.event.clearListeners(e.circles[a],"click"))},e.formatPhone=function(a){return a=a.slice(2),a.substring(0,3)+"-"+a.substring(3,6)+"-"+a.substring(6,a.length)},e.makeMap=function(){var a={center:{lat:42.3601,lng:-71.0589},zoom:15};e.map=new google.maps.Map(document.getElementById("map-canvas"),a),$.getJSON("data/citylimit.topojson",function(a){var b=topojson.feature(a,a.objects.collection);e.map.data.addGeoJson(b)}),e.map.data.setStyle({fillColor:"red",fillOpacity:.06,strokeColor:"red",strokeWeight:1})},e.chooseColor=function(a){for(var b=0;b<e.drinkPlaces.length-1;b++)if(e.drinkPlaces[b][0]===Number(e.foodPlaces[a].location.latitude)&&e.drinkPlaces[b][1]===Number(e.foodPlaces[a].location.longitude))return"#0000FF";return"#FF0000"},e.createCircles=function(){for(var a=0;a<e.foodPlaces.length-1;a++){var b=e.chooseColor(a),c=Number(e.foodPlaces[a].licenseadddttm.substring(0,4)),d=new google.maps.Circle({strokeColor:b,strokeOpacity:.8,strokeWeight:2,fillColor:b,fillOpacity:.6,clickable:!0,name:e.foodPlaces[a].businessname,address:e.foodPlaces[a].address,city:e.foodPlaces[a].city,phone:e.formatPhone(e.foodPlaces[a].dayphn),year:c,center:{lat:Number(e.foodPlaces[a].location.latitude),lng:Number(e.foodPlaces[a].location.longitude)},radius:10});google.maps.event.addListener(d,"click",e.showInfoWindow),e.circles.push(d)}},e.showInfoWindow=function(a){d&&d.close(),d=new google.maps.InfoWindow({content:'<div class="info"><h2>'+this.name+"</h2><h3>"+this.address+", "+this.city+"</h3><h4>Phone: "+this.phone+"</h4></div>"}),d.setPosition(a.latLng),d.open(e.map)},e.setHeatmap=function(){for(var a=[],b=0;b<e.circles.length;b++)e.circles[b].setMap(null);e.heatmap&&e.heatmap.setMap(null);for(var b=0;b<e.foodPlaces.length;b++){var c=Number(e.foodPlaces[b].licenseadddttm.substring(0,4));c<=Number(e.year)&&a.push(new google.maps.LatLng(Number(e.foodPlaces[b].location.latitude),Number(e.foodPlaces[b].location.longitude)))}var d=new google.maps.MVCArray(a);e.heatmap=new google.maps.visualization.HeatmapLayer({data:d}),e.heatmap.setMap(e.map),e.heatmap.set("radius",50),e.heatmap.set("maxIntensity",10)},e.showCircles=function(){for(var a=0;a<e.circles.length;a++)e.circles[a].year<=Number(e.year)&&e.circles[a].setMap(e.map)},e.makeMap(),e.getData()}angular.module("foodApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]),angular.module("foodApp").controller("MainCtrl",MainCtrl),MainCtrl.$inject=["requestFactory","$q","$timeout"],angular.module("foodApp").factory("requestFactory",["$http",function(a){var b=[],c=[],d=function(){return a.get("https://data.cityofboston.gov/resource/gb6y-34cq.json?$limit=3000&$$app_token=o8G9RFyZIGBbm4xexFrdV0Rfk").then(function(a){angular.copy(a.data,b)})},e=function(){return a.get("https://data.cityofboston.gov/resource/hda6-fnsh.json?$limit=3000&$$app_token=o8G9RFyZIGBbm4xexFrdV0Rfk").then(function(a){for(var b=0;b<a.data.length;b++)"NULL"!==a.data[b].location&&c.push([f(a.data[b].location),g(a.data[b].location)])})},f=function(a){var b=/\(.*,/;return a=b.exec(a)[0],a=a.slice(1),a=a.slice(0,-1),Number(a)},g=function(a){var b=/\s.*\)/;return a=b.exec(a)[0],a=a.slice(1),a=a.slice(0,-1),Number(a)};return{foodPlaces:b,drinkPlaces:c,getFoodPlaces:d,getDrinkPlaces:e}}]);