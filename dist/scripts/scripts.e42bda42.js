"use strict";function MainCtrl(a,b){var c=this;c.foodPlaces=a.foodPlaces,c.drinkPlaces=a.drinkPlaces,c.year=2006,c.getData=function(){b.all([a.getFoodPlaces(),a.getDrinkPlaces()]).then(c.drawFood)},c.updateSlider=function(){$("#sliderLabel").val(c.year);var a=c.foodPlaces.filter(c.pastDate);console.log(a.length)},c.pastDate=function(a){return Number(a.licenseadddttm.substring(0,4))>=$("#yearSlider").val()},c.formatPhone=function(a){return a=a.slice(2),a.substring(0,3)+"-"+a.substring(3,6)+"-"+a.substring(6,a.length)},c.initialize=function(){var a={center:{lat:42.3601,lng:-71.0589},zoom:14};c.map=new google.maps.Map(document.getElementById("map-canvas"),a),$.getJSON("data/citylimit.topojson",function(a){var b=topojson.feature(a,a.objects.collection);c.map.data.addGeoJson(b)}),c.map.data.setStyle({fillColor:"red",fillOpacity:.06,strokeColor:"red",strokeWeight:1})},c.drawFood=function(){for(var a,b,d=0;d<c.foodPlaces.length-1;d++){var e=function(){for(var a=0;a<c.drinkPlaces.length-1;a++)if(c.drinkPlaces[a][0]===Number(c.foodPlaces[d].location.latitude)&&c.drinkPlaces[a][1]===Number(c.foodPlaces[d].location.longitude))return"#0000FF";return"#FF0000"}();b=new google.maps.Circle({strokeColor:e,strokeOpacity:.8,strokeWeight:2,fillColor:e,fillOpacity:.6,clickable:!0,map:c.map,name:c.foodPlaces[d].businessname,address:c.foodPlaces[d].address,city:c.foodPlaces[d].city,phone:c.formatPhone(c.foodPlaces[d].dayphn),center:{lat:Number(c.foodPlaces[d].location.latitude),lng:Number(c.foodPlaces[d].location.longitude)},radius:10}),google.maps.event.addListener(b,"click",function(b){a&&a.close(),a=new google.maps.InfoWindow({content:'<div class="info"><h2>'+this.name+"</h2><h3>"+this.address+", "+this.city+"</h3><h4>Phone: "+this.phone+"</h4></div>"}),a.setPosition(b.latLng),a.open(c.map)})}},c.initialize(),c.getData()}angular.module("foodApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("foodApp").controller("MainCtrl",MainCtrl),MainCtrl.$inject=["requestFactory","$q"],angular.module("foodApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("foodApp").factory("requestFactory",["$http",function(a){var b=[],c=[],d=function(){return a.get("https://data.cityofboston.gov/resource/gb6y-34cq.json?$limit=3000&$$app_token=o8G9RFyZIGBbm4xexFrdV0Rfk").then(function(a){angular.copy(a.data,b)})},e=function(){return a.get("https://data.cityofboston.gov/resource/hda6-fnsh.json?$limit=3000&$$app_token=o8G9RFyZIGBbm4xexFrdV0Rfk").then(function(a){for(var b=0;b<a.data.length;b++)"NULL"!==a.data[b].location&&c.push([f(a.data[b].location),g(a.data[b].location)])})},f=function(a){var b=/\(.*,/;return a=b.exec(a)[0],a=a.slice(1),a=a.slice(0,-1),Number(a)},g=function(a){var b=/\s.*\)/;return a=b.exec(a)[0],a=a.slice(1),a=a.slice(0,-1),Number(a)};return{foodPlaces:b,drinkPlaces:c,getFoodPlaces:d,getDrinkPlaces:e}}]);